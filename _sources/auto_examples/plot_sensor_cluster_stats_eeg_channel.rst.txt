

.. _sphx_glr_auto_examples_plot_sensor_cluster_stats_eeg_channel.py:


===========================================
Non-parametric statistics on one EEG sensor
===========================================

Run a non-parametric cluster stats on sensor EEG070
on the contrast faces vs. scrambled.



.. code-block:: python


    import os.path as op
    import numpy as np
    from scipy import stats
    import matplotlib.pyplot as plt

    import mne
    from mne.stats import permutation_cluster_1samp_test

    from library.config import meg_dir, N_JOBS

    exclude = [1, 5, 16]  # Excluded subjects







Read all the data



.. code-block:: python


    contrasts = list()

    for subject_id in range(1, 20):
        if subject_id in exclude:
            continue
        subject = "sub%03d" % subject_id
        print("processing subject: %s" % subject)
        data_path = op.join(meg_dir, subject)
        contrast = mne.read_evokeds(op.join(data_path, '%s-ave.fif' % subject),
                                    condition='contrast')
        contrast.pick_types(meg=False, eeg=True)
        contrast.apply_baseline((-0.2, 0.0))
        contrasts.append(contrast)

    contrast = mne.combine_evoked(contrasts, 'equal')

    channel = 'EEG065'
    idx = contrast.ch_names.index(channel)
    mne.viz.plot_compare_evokeds(contrast, [idx])




.. image:: /auto_examples/images/sphx_glr_plot_sensor_cluster_stats_eeg_channel_001.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    processing subject: sub002
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub002/sub002-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 169 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub003
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub003/sub003-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 147 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub004
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub004/sub004-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 158 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub006
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub006/sub006-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 149 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub007
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 194 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub008
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub008/sub008-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 195 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub009
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub009/sub009-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 176 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub010
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub010/sub010-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 185 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub011
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub011/sub011-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 178 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub012
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub012/sub012-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 186 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub013
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub013/sub013-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 163 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub014
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub014/sub014-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 184 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub015
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub015/sub015-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 140 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub017
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub017/sub017-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 155 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub018
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub018/sub018-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 188 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)
    processing subject: sub019
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub019/sub019-ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 152 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
    Applying baseline correction (mode: mean)


Assemble the data and run the cluster stats on channel data



.. code-block:: python


    data = np.array([c.data[idx] for c in contrasts])

    n_permutations = 1000  # number of permutations to run

    # set family-wise p-value
    p_accept = 0.001

    connectivity = None
    tail = 0.  # for two sided test

    # set cluster threshold
    ppf = stats.t.ppf
    p_thresh = p_accept / (1 + (tail == 0))
    n_samples = len(data)
    threshold = -ppf(p_thresh, n_samples - 1)
    if np.sign(tail) < 0:
        threshold = -threshold

    cluster_stats = permutation_cluster_1samp_test(
        data, threshold=threshold, n_jobs=N_JOBS, verbose=True, tail=tail,
        step_down_p=0.05, connectivity=connectivity,
        n_permutations=n_permutations)

    T_obs, clusters, cluster_p_values, _ = cluster_stats





.. rst-class:: sphx-glr-script-out

 Out::

    stat_fun(H1): min=-8.220223 max=5.105649
    Running initial clustering
    Found 10 clusters
    Permuting ...
    Computing cluster p-values
    Step-down-in-jumps iteration #1 found 10 clusters to exclude from subsequent iterations
    Permuting ...
    Computing cluster p-values
    Step-down-in-jumps iteration #2 found 0 additional clusters to exclude from subsequent iterations
    Done.


Visualize results



.. code-block:: python


    from library.config import set_matplotlib_defaults
    set_matplotlib_defaults(plt)

    times = 1e3 * contrast.times

    plt.close('all')
    plt.subplot(211)
    plt.title('Channel : ' + channel)
    plt.plot(times, 1e6 * data.mean(axis=0), label="ERP Contrast")
    plt.ylabel("EEG (uV)")
    plt.ylim([-5, 2.5])
    plt.legend()
    plt.subplot(212)
    for i_c, c in enumerate(clusters):
        c = c[0]
        if cluster_p_values[i_c] <= p_accept:
            h1 = plt.axvspan(times[c.start], times[c.stop - 1],
                             color='r', alpha=0.3)
        else:
            h0 = plt.axvspan(times[c.start], times[c.stop - 1],
                             color=(0.3, 0.3, 0.3), alpha=0.3)
    hf = plt.plot(times, T_obs, 'g')
    plt.legend((h0, h1),
               ('cluster p-value > %s' % p_accept,
                'cluster p-value < %s' % p_accept),
               loc='best', ncol=1, fontsize=14)
    plt.xlabel("time (ms)")
    plt.ylabel("T-values")
    plt.ylim([-10., 10.])
    plt.xlim([-200, 800])
    plt.tight_layout()
    plt.show()
    plt.savefig('sensorstat.pdf', bbox_to_inches='tight')



.. image:: /auto_examples/images/sphx_glr_plot_sensor_cluster_stats_eeg_channel_002.png
    :align: center




**Total running time of the script:** ( 0 minutes  4.283 seconds)



.. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_sensor_cluster_stats_eeg_channel.py <plot_sensor_cluster_stats_eeg_channel.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_sensor_cluster_stats_eeg_channel.ipynb <plot_sensor_cluster_stats_eeg_channel.ipynb>`

.. rst-class:: sphx-glr-signature

    `Generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
