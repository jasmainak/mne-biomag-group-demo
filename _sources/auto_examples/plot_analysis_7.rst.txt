

.. _sphx_glr_auto_examples_plot_analysis_7.py:


======================
Analysis for subject 7
======================

Run the analysis.



.. code-block:: python

    import os
    import os.path as op
    import numpy as np

    import mne

    from library.config import study_path, meg_dir, ylim, l_freq







Configuration



.. code-block:: python


    subjects_dir = os.path.join(study_path, 'subjects')

    subject = "sub%03d" % int(7)

    fname = op.join(study_path, 'ds117', subject, 'MEG', 'run_01_raw.fif')
    raw = mne.io.read_raw_fif(fname)

    fname = op.join(meg_dir, subject,
                    'run_01_filt_sss_highpass-%sHz_raw.fif' % l_freq)
    # XXX: use same ICA regardless of l_freq because it fails when l_freq is None
    ica_fname = op.join(meg_dir, subject, 'run_01-ica.fif')
    raw_filt = mne.io.read_raw_fif(fname)





.. rst-class:: sphx-glr-script-out

 Out::

    Opening raw data file /tsi/doctorants/data_gramfort/dgw_faces/ds117/sub007/MEG/run_01_raw.fif...
        Read a total of 8 projection items:
            mag_ssp_upright.fif : PCA-mags-v1 (1 x 306)  idle
            mag_ssp_upright.fif : PCA-mags-v2 (1 x 306)  idle
            mag_ssp_upright.fif : PCA-mags-v3 (1 x 306)  idle
            mag_ssp_upright.fif : PCA-mags-v4 (1 x 306)  idle
            mag_ssp_upright.fif : PCA-mags-v5 (1 x 306)  idle
            grad_ssp_upright.fif : PCA-grad-v1 (1 x 306)  idle
            grad_ssp_upright.fif : PCA-grad-v2 (1 x 306)  idle
            grad_ssp_upright.fif : PCA-grad-v3 (1 x 306)  idle
        Range : 132000 ... 669899 =    120.000 ...   608.999 secs
    Ready.
    Current compensation grade : 0
    Opening raw data file /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/run_01_filt_sss_highpass-1Hz_raw.fif...
        Range : 132000 ... 669899 =    120.000 ...   608.999 secs
    Ready.
    Current compensation grade : 0


Filtering :ref:`sphx_glr_auto_scripts_02-python_filtering.py`.



.. code-block:: python

    raw.plot_psd(n_fft=2048, n_overlap=1024)
    raw_filt.plot_psd()




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_001.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_002.png
            :scale: 47


.. rst-class:: sphx-glr-script-out

 Out::

    Effective window size : 1.862 (s)
    Effective window size : 1.862 (s)
    Effective window size : 1.862 (s)
    Effective window size : 1.862 (s)
    Effective window size : 1.862 (s)
    Effective window size : 1.862 (s)


Events :ref:`sphx_glr_auto_scripts_03-run_extract_events.py`.
Epochs :ref:`sphx_glr_auto_scripts_05-make_epochs.py`.



.. code-block:: python

    events = mne.read_events(op.join(meg_dir, subject, 'run_01_filt_sss-eve.fif'))
    fig = mne.viz.plot_events(events, show=False)
    fig.suptitle('Events from run 01')

    data_path = op.join(meg_dir, subject)
    epochs = mne.read_epochs(op.join(data_path, '%s_highpass-%sHz-epo.fif'
                             % (subject, l_freq)))
    epochs.plot_drop_log()




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_003.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_004.png
            :scale: 47


.. rst-class:: sphx-glr-script-out

 Out::

    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007_highpass-1Hz-epo.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms
            0 CTF compensation matrices available
    845 matching events found
    Created an SSP operator (subspace dimension = 1)
    845 matching events found
    Created an SSP operator (subspace dimension = 1)
    1 projection items activated


Evoked responses :ref:`sphx_glr_auto_scripts_06-make_evoked.py`



.. code-block:: python

    evo_fname = op.join(data_path, '%s_highpass-%sHz_ave.fif' % (subject, l_freq))
    evoked = mne.read_evokeds(evo_fname)





.. rst-class:: sphx-glr-script-out

 Out::

    This filename (/tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007_highpass-1Hz_ave.fif) does not conform to MNE naming conventions. All evoked files should end with -ave.fif or -ave.fif.gz
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007_highpass-1Hz_ave.fif ...
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (famous)
            0 CTF compensation matrices available
            nave = 282 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (scrambled)
            0 CTF compensation matrices available
            nave = 282 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (unfamiliar)
            0 CTF compensation matrices available
            nave = 281 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (contrast)
            0 CTF compensation matrices available
            nave = 188 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
        Found the data of interest:
            t =    -200.00 ...     800.00 ms (faces)
            0 CTF compensation matrices available
            nave = 563 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    No baseline correction applied


Faces



.. code-block:: python

    famous_evo, scrambled_evo, unfamiliar_evo, contrast_evo, faces_evo = evoked
    faces_evo.plot(spatial_colors=True, gfp=True, ylim=ylim,
                   window_title='Faces %s' % subject)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_005.png
    :align: center




Famous



.. code-block:: python

    famous_evo.plot(spatial_colors=True, gfp=True, ylim=ylim,
                    window_title='Famous %s' % subject)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_006.png
    :align: center




Scrambled



.. code-block:: python

    scrambled_evo.plot(spatial_colors=True, gfp=True, ylim=ylim,
                       window_title='Scrambled %s' % subject)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_007.png
    :align: center




Unfamiliar



.. code-block:: python

    unfamiliar_evo.plot(spatial_colors=True, gfp=True, ylim=ylim,
                        window_title='Unfamiliar %s' % subject)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_008.png
    :align: center




Faces - scrambled



.. code-block:: python

    contrast_evo.plot(spatial_colors=True, gfp=True, ylim=ylim,
                      window_title='Faces - scrambled %s' % subject)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_009.png
    :align: center




Topomaps



.. code-block:: python

    times = np.arange(0.05, 0.3, 0.025)
    famous_evo.plot_topomap(times=times, title='Famous %s' % subject)
    scrambled_evo.plot_topomap(times=times, title='Scrambled %s' % subject)
    unfamiliar_evo.plot_topomap(times=times, title='Unfamiliar %s' % subject)
    contrast_evo.plot_topomap(times=times, title='Faces - scrambled %s' % subject)




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_010.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_011.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_012.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_013.png
            :scale: 47




ICA



.. code-block:: python

    ica = mne.preprocessing.read_ica(ica_fname)
    ica.plot_sources(raw_filt)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_014.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/run_01-ica.fif ...
    Now restoring ICA solution ...
    Ready.


TFR :ref:`sphx_glr_auto_scripts_07-time_frequency.py`.



.. code-block:: python

    fpower = mne.time_frequency.read_tfrs(
        op.join(meg_dir, subject, '%s-faces-tfr.h5' % subject))[0]
    fitc = mne.time_frequency.read_tfrs(
        op.join(meg_dir, subject, '%s-itc_faces-tfr.h5' % subject))[0]
    spower = mne.time_frequency.read_tfrs(
        op.join(meg_dir, subject, '%s-scrambled-tfr.h5' % subject))[0]
    sitc = mne.time_frequency.read_tfrs(
        op.join(meg_dir, subject, '%s-itc_scrambled-tfr.h5' % subject))[0]
    channel = 'EEG065'
    idx = [fpower.ch_names.index(channel)]
    fpower.plot(idx, title='Faces power %s' % channel, baseline=(-0.1, 0.0),
                mode='logratio')
    spower.plot(idx, title='Scrambled power %s' % channel, baseline=(-0.1, 0.0),
                mode='logratio')
    fitc.plot(idx, title='Faces ITC %s' % channel, baseline=(-0.1, 0.0),
              mode='logratio')
    sitc.plot(idx, title='Scrambled ITC %s' % channel, baseline=(-0.1, 0.0),
              mode='logratio')





.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_015.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_016.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_017.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_018.png
            :scale: 47


.. rst-class:: sphx-glr-script-out

 Out::

    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007-faces-tfr.h5 ...
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007-itc_faces-tfr.h5 ...
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007-scrambled-tfr.h5 ...
    Reading /tsi/doctorants/data_gramfort/dgw_faces/MEG/sub007/sub007-itc_scrambled-tfr.h5 ...
    Applying baseline correction (mode: logratio)
    Applying baseline correction (mode: logratio)
    Applying baseline correction (mode: logratio)
    Applying baseline correction (mode: logratio)


Covariance :ref:`sphx_glr_auto_scripts_06-make_evoked.py`.



.. code-block:: python

    cov = mne.read_cov(op.join(meg_dir, subject, '%s-cov.fif' % subject))
    mne.viz.plot_cov(cov, faces_evo.info)
    faces_evo.plot_white(cov)




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_019.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_020.png
            :scale: 47

    *

      .. image:: /auto_examples/images/sphx_glr_plot_analysis_7_021.png
            :scale: 47


.. rst-class:: sphx-glr-script-out

 Out::

    376 x 376 full covariance (kind = 1) found.
        Read a total of 1 projection items:
            Average EEG reference (1 x 70) active
    SSS has been applied to data. Showing mag and grad whitening jointly.
    estimated rank (eeg): 70
    estimated rank (mag + grad): 306
        Created an SSP operator (subspace dimension = 1)
    Setting small MEG eigenvalues to zero.
    Not doing PCA for MEG.
    Setting small EEG eigenvalues to zero.
    Not doing PCA for EEG.


Trans



.. code-block:: python

    fname_trans = op.join(study_path, 'ds117', subject, 'MEG',
                          '%s-trans.fif' % subject)
    mne.viz.plot_trans(famous_evo.info, fname_trans, subject=subject,
                       subjects_dir=subjects_dir, meg_sensors=True,
                       eeg_sensors=True)




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_022.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Using surface from /tsi/doctorants/data_gramfort/dgw_faces/subjects/sub007/bem/sub007-head.fif.
    Getting helmet for system 306m


Faces :ref:`sphx_glr_auto_scripts_13-make_inverse.py`.



.. code-block:: python



    def plot_stc(cond):
        fname = op.join(meg_dir, subject, 'mne_dSPM_inverse-%s' % cond)
        stc = mne.read_source_estimate(fname, subject)
        brain = stc.plot(subject=subject, subjects_dir=subjects_dir, views=['ven'],
                         hemi='both', initial_time=0.17, time_unit='s')
        return brain

    brain = plot_stc('faces')




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_023.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=5.80e+00 fmid=6.67e+00 fmax=1.70e+01 transparent=1
    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=5.80e+00 fmid=6.67e+00 fmax=1.70e+01 transparent=1


Faces - scrambled



.. code-block:: python

    brain = plot_stc('contrast')




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_024.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=2.27e+00 fmid=2.56e+00 fmax=5.33e+00 transparent=1
    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=2.27e+00 fmid=2.56e+00 fmax=5.33e+00 transparent=1


LCMV Faces - scrambled



.. code-block:: python

    fname = op.join(meg_dir, subject, 'mne_LCMV_inverse-contrast')
    stc = mne.read_source_estimate(fname, subject)
    stc.plot(subject=subject, subjects_dir=subjects_dir, views=['ven'],
             hemi='both', initial_time=0.17, time_unit='s')




.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_025.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=1.52e-01 fmid=1.73e-01 fmax=4.63e-01 transparent=1
    Updating smoothing matrix, be patient..
    Smoothing matrix creation, step 1
    Smoothing matrix creation, step 2
    Smoothing matrix creation, step 3
    Smoothing matrix creation, step 4
    Smoothing matrix creation, step 5
    Smoothing matrix creation, step 6
    Smoothing matrix creation, step 7
    Smoothing matrix creation, step 8
    Smoothing matrix creation, step 9
    Smoothing matrix creation, step 10
    colormap: fmin=1.52e-01 fmid=1.73e-01 fmax=4.63e-01 transparent=1


BEM



.. code-block:: python

    mne.viz.plot_bem(subject, subjects_dir)



.. image:: /auto_examples/images/sphx_glr_plot_analysis_7_026.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Using surface: /tsi/doctorants/data_gramfort/dgw_faces/subjects/sub007/bem/inner_skull.surf
    Using surface: /tsi/doctorants/data_gramfort/dgw_faces/subjects/sub007/bem/outer_skull.surf
    Using surface: /tsi/doctorants/data_gramfort/dgw_faces/subjects/sub007/bem/outer_skin.surf


**Total running time of the script:** ( 2 minutes  46.090 seconds)



.. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_analysis_7.py <plot_analysis_7.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_analysis_7.ipynb <plot_analysis_7.ipynb>`

.. rst-class:: sphx-glr-signature

    `Generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
